<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Panel DESDI - Aplicaciones Combuses</title>

<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#0f172a">

<link rel="preconnect" href="https://script.google.com">
<link rel="preconnect" href="https://script.googleusercontent.com">

<style>
/* ================== BASE ================== */
html, body { height: 100%; margin: 0; }
body{
  display:flex; flex-direction:column;
  background:#0b1220; color:#e5e7eb;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
}

/* ================== APP BAR ================== */
.appbar{
  height:52px; flex-shrink:0;
  background:#0f172a;
  display:flex; align-items:center; justify-content:space-between;
  padding:0 14px;
  border-bottom:1px solid #1f2937;
}
.appbar .left{ display:flex; align-items:center; gap:10px; }
.appbar h1{ font-size:16px; margin:0; font-weight:700; }

.appbar .actions{ display:flex; gap:8px; align-items:center; }

.btn{
  border:1px solid #334155;
  background:#111827;
  color:#e5e7eb;
  padding:6px 10px;
  border-radius:10px;
  cursor:pointer;
  text-decoration:none;
  display:inline-flex; align-items:center; gap:6px;
}
.btn.secondary{ background:transparent; }
.btn.icon{ padding:6px 10px; }

/* ================== MAIN ================== */
.main-container{
  display:flex;
  flex:1;
  min-height:0;
  position:relative;
}

/* ================== SIDEBAR ================== */
.apps-sidebar{
  width:260px;
  background:#0f172a;
  border-right:1px solid #1f2937;
  display:flex;
  flex-direction:column;
  min-height:0;
}
.sidebar-header{
  padding:14px;
  font-weight:600;
  border-bottom:1px solid #1f2937;
}
.apps-list{ flex:1; overflow-y:auto; }

.app-item{
  display:flex;
  gap:12px;
  padding:12px 16px;
  cursor:pointer;
  border-left:3px solid transparent;
  user-select:none;
}
.app-item:hover{ background:rgba(59,130,246,.12); }
.app-item.active{
  background:rgba(59,130,246,.18);
  border-left-color:#3b82f6;
}
.app-icon{
  width:36px; height:36px;
  border-radius:10px;
  display:flex; align-items:center; justify-content:center;
  flex-shrink:0;
}

/* ================== IFRAME AREA ================== */
.iframe-area{
  flex:1;
  display:flex;
  flex-direction:column;
  min-height:0;
}
.iframe-toolbar{
  height:44px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 12px;
  background:#0f172a;
  border-bottom:1px solid #1f2937;
}
.iframe-title{ font-weight:600; }

.iframe-container{
  flex:1;
  position:relative;
  min-height:0;
  background:#fff;
}
.iframe-wrapper{
  position:absolute;
  inset:0;
  min-height:0;
}
iframe{
  width:100%;
  height:100%;
  border:0;
  display:block;
}

/* Loader */
.loader{
  position:absolute;
  inset:0;
  background:rgba(4,6,17,.9);
  display:grid;
  place-items:center;
  z-index:10;
}
.loader.hidden{ display:none; }
.spinner{
  width:42px; height:42px;
  border-radius:50%;
  border:4px solid #1f2937;
  border-top-color:#3b82f6;
  animation:spin .8s linear infinite;
}
@keyframes spin{ to{ transform:rotate(360deg); } }

/* ================== DRAWER MOBILE ================== */
.backdrop{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.55);
  display:none;
  z-index:40;
}

@media (max-width:900px){
  .apps-sidebar{
    position:absolute;
    inset:0 auto 0 0;
    width:min(86vw,320px);
    transform:translateX(-105%);
    transition:transform .22s ease;
    z-index:50;
    box-shadow:20px 0 50px rgba(0,0,0,.35);
  }
  body.menu-open .apps-sidebar{ transform:translateX(0); }
  body.menu-open .backdrop{ display:block; }
}

@media (min-width:901px){
  #btnMenu{ display:none; }
}
</style>
</head>

<body>

<header class="appbar">
  <div class="left">
    <button class="btn icon" id="btnMenu">â˜°</button>
    <h1>ðŸšŒ Panel DESDI</h1>
  </div>
  <div class="actions">
    <button class="btn" id="btnReload">â†» Recargar</button>
    <a class="btn secondary" id="btnOpen" target="_blank">â†— Abrir</a>
  </div>
</header>

<div class="main-container">

  <div class="backdrop" id="backdrop"></div>

  <aside class="apps-sidebar">
    <div class="sidebar-header">Aplicaciones DESDI</div>
    <div class="apps-list" id="appsList"></div>
  </aside>

  <section class="iframe-area">
    <div class="iframe-toolbar">
      <div class="iframe-title" id="currentTitle">Seleccione una aplicaciÃ³n</div>
      <a class="btn secondary" id="btnOpenCurrent" target="_blank" style="display:none">â†— Abrir</a>
    </div>

    <div class="iframe-container">
      <div class="loader" id="loader"><div class="spinner"></div></div>
      <div class="iframe-wrapper" id="iframeWrapper"></div>
    </div>
  </section>

</div>

<script>
(function(){

const APPS = [
  {
    id:'ruta700',
    name:'ðŸ“‹ Despacho RUTA 700',
    url:'https://script.google.com/macros/s/AKfycbwICLOgJOZJ25VphPfnJgBv9cmD_09eUt03RhaIUilEIgwLnxeNS4094A9PnUBoiGjWgw/exec',
    icon:'ðŸ“‹',
    color:'#3b82f6'
  },
  {
    id:'cancelacion',
    name:'âŒ CancelaciÃ³n de Viajes Despachados',
    url:'https://script.google.com/macros/s/AKfycbzkDe6hWox2ots2TA_QSIfYj6UinAOg47V5Zsk26H_CbNry5s84bIZLDYvPRE1k3BYv/exec',
    icon:'âŒ',
    color:'#ef4444'
  },
  {
    id:'nueva',
    name:'ðŸ§© Formulario de Objetos Perdidos',
    url:'https://script.google.com/macros/s/AKfycbxsZD5tM8zGX9h81Hnv6NfnKaaaktI-Kl0A7LF8q-mmEEJ0WhQC9C0o6XEBaeSxRS1o/exec',
    icon:'ðŸ§©',
    color:'#22c55e'
  }
];

const appsList = document.getElementById('appsList');
const iframeWrapper = document.getElementById('iframeWrapper');
const loader = document.getElementById('loader');
const btnReload = document.getElementById('btnReload');
const btnOpen = document.getElementById('btnOpen');
const btnOpenCurrent = document.getElementById('btnOpenCurrent');
const currentTitle = document.getElementById('currentTitle');
const btnMenu = document.getElementById('btnMenu');
const backdrop = document.getElementById('backdrop');

let currentApp = null;
let currentIframe = null;

function isMobile(){
  return window.matchMedia('(max-width:900px)').matches;
}
function showLoader(){ loader.classList.remove('hidden'); }
function hideLoader(){ loader.classList.add('hidden'); }

function renderApps(){
  appsList.innerHTML='';
  APPS.forEach(app=>{
    const el=document.createElement('div');
    el.className='app-item';
    el.dataset.id=app.id;
    el.innerHTML=`
      <div class="app-icon" style="background:${app.color}22;color:${app.color}">${app.icon}</div>
      <div>${app.name}</div>
    `;
    el.addEventListener('click', (e)=>{
      e.stopPropagation();
      selectApp(app);
    });
    appsList.appendChild(el);
  });
}

function setActive(id){
  [...appsList.children].forEach(el=>{
    el.classList.toggle('active', el.dataset.id===id);
  });
}

function selectApp(app){
  currentApp=app;
  currentTitle.textContent=app.name;
  btnOpen.href=app.url;
  btnOpenCurrent.href=app.url;
  btnOpenCurrent.style.display='inline-flex';

  setActive(app.id);
  loadIframe(app.url);

  // ðŸ”¥ CIERRE FORZADO DEL MENÃš
  document.body.classList.remove('menu-open');
}

function loadIframe(url){
  showLoader();
  if(currentIframe) currentIframe.remove();

  const iframe=document.createElement('iframe');
  iframe.src=url+'?t='+Date.now();
  iframe.allow='camera; microphone; geolocation';
  iframe.onload=hideLoader;

  iframeWrapper.appendChild(iframe);
  currentIframe=iframe;
}

btnMenu.addEventListener('click',(e)=>{
  e.stopPropagation();
  document.body.classList.toggle('menu-open');
});

backdrop.addEventListener('click',()=>{
  document.body.classList.remove('menu-open');
});

btnReload.onclick=()=>currentApp && loadIframe(currentApp.url);
btnOpen.onclick=e=>{ e.preventDefault(); currentApp && window.open(currentApp.url); };
btnOpenCurrent.onclick=e=>{ e.preventDefault(); currentApp && window.open(currentApp.url); };

renderApps();
selectApp(APPS[0]);
document.body.classList.remove('menu-open');

})();
</script>

</body>
</html>


